{"ast":null,"code":"// modal.service.ts\nimport { EnvironmentInjector, Injector, TemplateRef, ViewContainerRef, inject } from \"@angular/core\";\nimport { DialogRef } from \"./dialog-ref\";\nimport { ModalComponent } from \"./modal/modal.component\";\nimport * as i0 from \"@angular/core\";\nexport class DialogService {\n  constructor() {\n    this.dialogRefs = {};\n    this.injector = inject(Injector);\n    this.environmentInjector = inject(EnvironmentInjector);\n    this.viewContainerRef = undefined;\n  }\n  init(vcr) {\n    this.viewContainerRef = vcr;\n  }\n  open(content) {\n    if (!this.viewContainerRef) {\n      throw \"ViewContainerRef is not initialized\";\n    }\n    const dialogRef = new DialogRef();\n    const providers = [{\n      provide: DialogRef,\n      useValue: dialogRef\n    }];\n    const injector = Injector.create({\n      providers,\n      parent: this.injector\n    });\n    let modalRef;\n    if (content instanceof TemplateRef) {\n      const contentRef = this.viewContainerRef?.createEmbeddedView(content, undefined, {\n        injector\n      });\n      modalRef = this.viewContainerRef?.createComponent(ModalComponent, {\n        environmentInjector: this.environmentInjector,\n        injector,\n        projectableNodes: [contentRef.rootNodes]\n      });\n    } else {\n      modalRef = this.viewContainerRef?.createComponent(ModalComponent, {\n        environmentInjector: this.environmentInjector,\n        injector\n      });\n      modalRef.injector.get(ViewContainerRef).createComponent(content, {\n        environmentInjector: this.environmentInjector,\n        injector\n      });\n    }\n    dialogRef.componentRef = modalRef;\n    dialogRef.componentInstance = modalRef.instance;\n    const refIdentifier = crypto.randomUUID();\n    this.dialogRefs[refIdentifier] = modalRef;\n    dialogRef.closed.subscribe(() => {\n      this.removeDialog(refIdentifier);\n    });\n    return dialogRef;\n  }\n  removeDialog(refIdentifier) {\n    this.dialogRefs[refIdentifier].destroy();\n  }\n  static #_ = this.ɵfac = function DialogService_Factory(t) {\n    return new (t || DialogService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: DialogService,\n    factory: DialogService.ɵfac,\n    providedIn: \"root\"\n  });\n}","map":{"version":3,"names":["EnvironmentInjector","Injector","TemplateRef","ViewContainerRef","inject","DialogRef","ModalComponent","DialogService","constructor","dialogRefs","injector","environmentInjector","viewContainerRef","undefined","init","vcr","open","content","dialogRef","providers","provide","useValue","create","parent","modalRef","contentRef","createEmbeddedView","createComponent","projectableNodes","rootNodes","get","componentRef","componentInstance","instance","refIdentifier","crypto","randomUUID","closed","subscribe","removeDialog","destroy","_","_2","factory","ɵfac","providedIn"],"sources":["/Users/facundo.abdo/Develop/angular-modal-service/src/app/dialog/dialog.service.ts"],"sourcesContent":["// modal.service.ts\n\nimport {\n  ComponentRef,\n  EnvironmentInjector,\n  Injectable,\n  Injector,\n  StaticProvider,\n  TemplateRef,\n  Type,\n  ViewContainerRef,\n  createComponent,\n  inject,\n} from \"@angular/core\";\n\nimport { DialogRef } from \"./dialog-ref\";\nimport { ModalComponent } from \"./modal/modal.component\";\n\n@Injectable({\n  providedIn: \"root\",\n})\nexport class DialogService {\n  private dialogRefs: { [key: string]: ComponentRef<any> } = {};\n  private injector = inject(Injector);\n  private environmentInjector = inject(EnvironmentInjector);\n  private viewContainerRef: ViewContainerRef | undefined = undefined;\n\n  constructor() {}\n\n  init(vcr: ViewContainerRef) {\n    this.viewContainerRef = vcr;\n  }\n\n  open<T>(content: TemplateRef<T> | Type<T>): any {\n    if (!this.viewContainerRef) {\n      throw \"ViewContainerRef is not initialized\";\n    }\n\n    const dialogRef = new DialogRef();\n\n    const providers: StaticProvider[] = [\n      { provide: DialogRef, useValue: dialogRef },\n    ];\n\n    const injector = Injector.create({\n      providers,\n      parent: this.injector,\n    });\n\n    let modalRef: ComponentRef<ModalComponent>;\n\n    if (content instanceof TemplateRef) {\n      const contentRef = this.viewContainerRef?.createEmbeddedView(\n        content,\n        undefined,\n        {\n          injector,\n        }\n      );\n\n      modalRef = this.viewContainerRef?.createComponent(ModalComponent, {\n        environmentInjector: this.environmentInjector,\n        injector,\n        projectableNodes: [contentRef.rootNodes],\n      });\n    } else {\n      modalRef = this.viewContainerRef?.createComponent(ModalComponent, {\n        environmentInjector: this.environmentInjector,\n        injector,\n      });\n\n      modalRef.injector.get(ViewContainerRef).createComponent(content as Type<T>,{\n        environmentInjector: this.environmentInjector,\n        injector,\n      });\n    }\n\n    (dialogRef as { componentRef: ComponentRef<ModalComponent> }).componentRef =\n      modalRef;\n    (dialogRef as { componentInstance: ModalComponent }).componentInstance =\n      modalRef.instance;\n\n    const refIdentifier = crypto.randomUUID();\n    this.dialogRefs[refIdentifier] = modalRef;\n\n    dialogRef.closed.subscribe(() => {\n      this.removeDialog(refIdentifier);\n    });\n\n    return dialogRef;\n  }\n\n  removeDialog(refIdentifier: string) {\n    this.dialogRefs[refIdentifier].destroy();\n  }\n}\n"],"mappings":"AAAA;AAEA,SAEEA,mBAAmB,EAEnBC,QAAQ,EAERC,WAAW,EAEXC,gBAAgB,EAEhBC,MAAM,QACD,eAAe;AAEtB,SAASC,SAAS,QAAQ,cAAc;AACxC,SAASC,cAAc,QAAQ,yBAAyB;;AAKxD,OAAM,MAAOC,aAAa;EAMxBC,YAAA;IALQ,KAAAC,UAAU,GAAyC,EAAE;IACrD,KAAAC,QAAQ,GAAGN,MAAM,CAACH,QAAQ,CAAC;IAC3B,KAAAU,mBAAmB,GAAGP,MAAM,CAACJ,mBAAmB,CAAC;IACjD,KAAAY,gBAAgB,GAAiCC,SAAS;EAEnD;EAEfC,IAAIA,CAACC,GAAqB;IACxB,IAAI,CAACH,gBAAgB,GAAGG,GAAG;EAC7B;EAEAC,IAAIA,CAAIC,OAAiC;IACvC,IAAI,CAAC,IAAI,CAACL,gBAAgB,EAAE;MAC1B,MAAM,qCAAqC;;IAG7C,MAAMM,SAAS,GAAG,IAAIb,SAAS,EAAE;IAEjC,MAAMc,SAAS,GAAqB,CAClC;MAAEC,OAAO,EAAEf,SAAS;MAAEgB,QAAQ,EAAEH;IAAS,CAAE,CAC5C;IAED,MAAMR,QAAQ,GAAGT,QAAQ,CAACqB,MAAM,CAAC;MAC/BH,SAAS;MACTI,MAAM,EAAE,IAAI,CAACb;KACd,CAAC;IAEF,IAAIc,QAAsC;IAE1C,IAAIP,OAAO,YAAYf,WAAW,EAAE;MAClC,MAAMuB,UAAU,GAAG,IAAI,CAACb,gBAAgB,EAAEc,kBAAkB,CAC1DT,OAAO,EACPJ,SAAS,EACT;QACEH;OACD,CACF;MAEDc,QAAQ,GAAG,IAAI,CAACZ,gBAAgB,EAAEe,eAAe,CAACrB,cAAc,EAAE;QAChEK,mBAAmB,EAAE,IAAI,CAACA,mBAAmB;QAC7CD,QAAQ;QACRkB,gBAAgB,EAAE,CAACH,UAAU,CAACI,SAAS;OACxC,CAAC;KACH,MAAM;MACLL,QAAQ,GAAG,IAAI,CAACZ,gBAAgB,EAAEe,eAAe,CAACrB,cAAc,EAAE;QAChEK,mBAAmB,EAAE,IAAI,CAACA,mBAAmB;QAC7CD;OACD,CAAC;MAEFc,QAAQ,CAACd,QAAQ,CAACoB,GAAG,CAAC3B,gBAAgB,CAAC,CAACwB,eAAe,CAACV,OAAkB,EAAC;QACzEN,mBAAmB,EAAE,IAAI,CAACA,mBAAmB;QAC7CD;OACD,CAAC;;IAGHQ,SAA4D,CAACa,YAAY,GACxEP,QAAQ;IACTN,SAAmD,CAACc,iBAAiB,GACpER,QAAQ,CAACS,QAAQ;IAEnB,MAAMC,aAAa,GAAGC,MAAM,CAACC,UAAU,EAAE;IACzC,IAAI,CAAC3B,UAAU,CAACyB,aAAa,CAAC,GAAGV,QAAQ;IAEzCN,SAAS,CAACmB,MAAM,CAACC,SAAS,CAAC,MAAK;MAC9B,IAAI,CAACC,YAAY,CAACL,aAAa,CAAC;IAClC,CAAC,CAAC;IAEF,OAAOhB,SAAS;EAClB;EAEAqB,YAAYA,CAACL,aAAqB;IAChC,IAAI,CAACzB,UAAU,CAACyB,aAAa,CAAC,CAACM,OAAO,EAAE;EAC1C;EAAC,QAAAC,CAAA,G;qBAzEUlC,aAAa;EAAA;EAAA,QAAAmC,EAAA,G;WAAbnC,aAAa;IAAAoC,OAAA,EAAbpC,aAAa,CAAAqC,IAAA;IAAAC,UAAA,EAFZ;EAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}